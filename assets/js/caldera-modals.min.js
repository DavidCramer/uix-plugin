!function(e){var t,o,i,a=null,d={},n=[],l=[],c=function(){if(n.length||l.length){var e=n.length?n[n.length-1]:l[l.length-1],c=i.width(),s=i.height(),r=d[e].config.height,g=r,m=d[e].config.width,f=0,h=!1,p=!1;if(a&&t.addClass("has-caldera-modal"),f=(s-d[e].config.height)/2.2,0>f&&(f=0),r+2*d[e].config.padding>s&&a&&(r=s-2*d[e].config.padding,g="100%",a&&a.css({paddingTop:d[e].config.padding,paddingBottom:d[e].config.padding}),p=!0),m+2*d[e].config.padding>=c&&(m="100%",a&&a.css({paddingLeft:d[e].config.padding,paddingRight:d[e].config.padding}),p=!0),!0===p&&(700>=c&&c>600?(a&&(r=s-2*d[e].config.padding),m=c,g=r-2*d[e].config.padding,m="100%",f=0,a&&a.css({padding:d[e].config.padding})):600>=c&&(a&&(r=s),m=c,g="100%",f=0,a&&a.css({padding:0}))),a&&a.is(":hidden")&&(h=!0,a.show()),d[e].header&&(a&&a.show(),r-=d[e].header.outerHeight(),d[e].closer.css({padding:d[e].header.outerHeight()/2-.5}),d[e].title.css({paddingRight:d[e].closer.outerWidth()})),d[e].footer&&(a&&a.show(),r-=d[e].footer.outerHeight()),a&&h===!0&&(a.hide(),h=!1),r!=g&&d[e].body.css({height:r}),d[e].modal.css({width:m}),d[e].config.sticky&&d[e].config.minimized){var u={},w=d[e].title.outerHeight()-d[e].modal.outerHeight();d[e].config.sticky.indexOf("bottom")>-1?u["margin-bottom"]=w:d[e].config.sticky.indexOf("top")>-1&&(u["margin-top"]=w),d[e].modal.css(u),d[e].config.sticky.length>=3&&(o.css("margin-"+d[e].config.sticky[0],d[e].title.outerHeight()),p?d[e].modal.css(d[e].config.sticky[1],0):d[e].modal.css(d[e].config.sticky[1],parseFloat(d[e].config.sticky[2])))}return a&&(d[e].modal.css({marginTop:f,height:g}),setTimeout(function(){d[e].modal.addClass("caldera-animate")},10),a.fadeIn(d[e].config.speed)),d}},s=function(o){var i=e(o).data("modal"),l=0,c={};if(o&&d[i].config.sticky)return d[i].config.minimized?(d[i].config.minimized=!1,l=0):(d[i].config.minimized=!0,l=d[i].title.outerHeight()-d[i].modal.outerHeight()),d[i].config.sticky.indexOf("bottom")>-1?c["margin-bottom"]=l:d[i].config.sticky.indexOf("top")>-1&&(c["margin-top"]=l),void d[i].modal.stop().animate(c,d[i].config.speed);var s;n.length&&(s=n.pop(),d[s].modal.hasClass("caldera-animate")&&!n.length?(d[s].modal.removeClass("caldera-animate"),setTimeout(function(){d[s].modal.remove(),delete d[s]},500)):a&&d[s].modal.hide(0,function(){e(this).remove(),delete d[s]})),n.length?d[n[n.length-1]].modal.show():(a&&a.fadeOut(250,function(){e(this).remove(),a=null}),t.removeClass("has-caldera-modal"))};e.calderaModal=function(t,i){var r=e.extend(!0,{element:"div",height:550,width:620,padding:12,speed:250},t);r.trigger=i,a||r.sticky||(a=e("<div>",{"class":"caldera-backdrop"}),r.focus||a.on("click",function(e){e.target==this&&s()}),o.append(a),a.hide());var g=r.element,m=r.modal;if(n.length&&n[n.length-1]!==m&&d[n[n.length-1]].modal.hide(),"undefined"==typeof d[m]?(r.sticky&&(r.sticky=r.sticky.split(" "),r.sticky.length<2&&(r.sticky=null),l.push(m)),d[m]={config:r,modal:e("<"+g+">",{id:m+"_calderaModal",tabIndex:-1,"ariaLabelled-by":m+"_calderaModalLable","class":"caldera-modal-wrap"+(r.sticky?" caldera-sticky-modal "+r.sticky[0]+"-"+r.sticky[1]:"")})},r.sticky||n.push(m)):(d[m].config=r,d[m].modal.empty()),r.animate&&a){var f=r.animate.split(" "),h=r.speed+"ms",p=r.animateEase?r.animateEase:"ease";1===f.length&&(f[1]=0),d[m].modal.css({transform:"translate("+f[0]+", "+f[1]+")","-web-kit-transition":"transform "+h+" "+p,"-moz-transition":"transform "+h+" "+p,transition:"transform "+h+" "+p})}if(d[m].body=e("<div>",{"class":"caldera-modal-body",id:m+"_calderaModalBody"}),d[m].content=e("<div>",{"class":"caldera-modal-content",id:m+"_calderaModalContent"}),d[m].content.css({margin:r.padding}),d[m].body.append(d[m].content).appendTo(d[m].modal),a?a.append(d[m].modal):d[m].modal.appendTo(e("body")),r.footer)if(d[m].footer=e("<div>",{"class":"caldera-modal-footer",id:m+"_calderaModalFooter"}),d[m].footer.css({padding:r.padding}),d[m].footer.appendTo(d[m].modal),"function"==typeof window[r.footer])d[m].footer.append(window[r.footer](r,d[m]));else if("string"==typeof r.footer)try{var u=e(r.footer);d[m].footer.html(u.html())}catch(w){d[m].footer.html(r.footer)}if(r.title){var y="prependTo";d[m].header=e("<div>",{"class":"caldera-modal-title",id:m+"_calderaModalTitle"}),d[m].closer=e("<a>",{href:"#close","class":"caldera-modal-closer","data-dismiss":"modal","aria-hidden":"true",id:m+"_calderaModalCloser"}).html("&times;"),d[m].title=e("<h3>",{"class":"modal-label",id:m+"_calderaModalLable"}),d[m].title.html(r.title).appendTo(d[m].header),d[m].title.css({padding:r.padding}),d[m].title.append(d[m].closer),d[m].config.sticky?(d[m].config.minimized&&!0!==d[m].config.minimized&&(setTimeout(function(){d[m].title.trigger("click")},parseInt(d[m].config.minimized)),d[m].config.minimized=!1),d[m].closer.hide(),d[m].title.addClass("caldera-modal-closer").data("modal",m).appendTo(d[m].header),d[m].config.sticky.indexOf("top")>-1&&(y="appendTo")):d[m].closer.data("modal",m).appendTo(d[m].header),d[m].header[y](d[m].modal)}if(d[m].modal.outerHeight(r.height),d[m].modal.outerWidth(r.width),r.content)if("function"==typeof window[r.content])d[m].content.append(window[r.content](r,d[m]));else if("string"==typeof r.content)try{var k=e(r.content);k.length?(d[m].content.append(k.detach()),k.show()):d[m].content.html(r.content)}catch(w){d[m].content.html(r.content)}return c(),d[m]},e.fn.calderaModal=function(a){return t=e("html"),o=e("body"),i=e(window),a||(a={}),a=e.extend({},this.data(),a),e.calderaModal(a,this)},window.addEventListener?(window.addEventListener("resize",c,!1),window.addEventListener("keypress",function(e){27===e.keyCode&&null!==a&&a.trigger("click")},!1)):window.attachEvent?window.attachEvent("onresize",c):window.onresize=c,e(document).on("click","[data-modal]:not(.caldera-modal-closer)",function(t){t.preventDefault(),e(this).calderaModal()}),e(document).on("click",".caldera-modal-closer",function(t){t.preventDefault(),e(window).trigger("close.modal")}),e(window).on("close.modal",function(e){s()}),e(window).on("modal.init",function(t){e("[data-modal][data-autoload]").each(function(){e(this).calderaModal()})}),e(window).load(function(){e(window).trigger("modal.init")})}(jQuery);