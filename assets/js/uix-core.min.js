var conduitApp={},coduitTemplates={},conduitRegisterApps,conduitModal,conduitModalSave,conduitGenID,conduitGetData;!jQuery(function(t){conduitException=function(t){this.message=t,this.name="ConduitException"},t.fn.conduitTrigger=function(a){var i={method:"GET",url:ajaxurl};return t.extend(!0,i,a),t.ajax(i).success(function(){}),this},t.fn.getObject=function(){for(var a=t(this),i=a.find("[name]"),e={},n={},d=0;d<i.length;d++){var o=t(i[d]),c=o.prop("name").replace(/\]/gi,"").split("["),u=o.val(),p={};if(!o.is(":radio")&&!o.is(":checkbox")||o.is(":checked")){if(o.prop("required")&&!o.val().length)throw o.focus(),new conduitException("requiredfield");for(var r=c.length-1;r>=0;r--){var s=c[r];if("undefined"==typeof s&&(s=""),0===s.length&&(p=[],"undefined"==typeof n[c[r-1]]?n[c[r-1]]=0:n[c[r-1]]+=1,s=n[c[r-1]]),r===c.length-1){if(u)if("true"===u)u=!0;else if("false"===u)u=!1;else if(isNaN(parseFloat(u))||parseFloat(u).toString()!==u)if("string"!=typeof u||"{"!==u.substr(0,1)&&"["!==u.substr(0,1)){if("object"==typeof u&&u.length&&o.is("select")){for(var l={},r=0;r<u.length;r++)l["n"+r]=u[r];u=l}}else try{u=JSON.parse(u)}catch(f){}else u=parseFloat(u);p[s]=u}else{var v=p;p={},p[s]=v}}t.extend(!0,e,p)}}return e},conduitGeneralBaldrick=function(){t(".wp-trigger").conduitTrigger({method:"POST",before:function(a){var i=t(a),e=i.closest("[data-app]");e.length?i.data("data",JSON.stringify(conduitBuildData(e.data("app")))):i.data("data")&&i.data("data",JSON.stringify(conduitBuildData(i.data("data"))))}})},conduitPrepObject=function(){var t={};for(var a in conduitApp)conduitApp[a].app&&(conduitApp[a].app.is(":visible")?t[a]=conduitBuildData(a):t[a]=conduitApp[a].data);return t},conduitModalFooter=function(a){var i,e=a.buttons?a.buttons.split(" "):["save"],n=a.modal.split("."),d=a.app?a.app:n.shift(),o={__node_path:n.join(".")},c="";o.__app=d;for(var u=0;u<e.length;u++)c+=t("#__partial_"+e[u]).length?t("#__partial_"+e[u]).html():"";return(i=Handlebars.compile(c,{data:!0}))(o)},conduitModal=function(t,a){var i=t.modal.split("."),e=t.app?t.app:i.shift(),n=t["default"]?t["default"]:null,d=Handlebars.compile('<div data-app="'+t.template+'">{{> '+t.template+"}}</div>",{data:!0});if(data={},conduitBuildData(e),conduitApp[e]){var o=conduitApp[e].data;if(null!==n)data=n;else{for(var c=0;c<i.length;c++)o=o[i[c]]?o[i[c]]:{};data=o}}return data.__node_path=t.points,data.__app=e,conduitApp[t.template]={app:a.content,data:data},coduitTemplates[t.template]=d,d(data)},conduitGetData=function(t){var a=t.trigger.data("app"),i={};return conduitApp[a]&&conduitApp[a].data?conduitApp[a].data:i},conduitBuildData=function(t){if(conduitApp[t]&&conduitApp[t].app)try{conduitApp[t].data=conduitApp[t].app.getObject()}catch(a){return!1}return conduitApp[t].data},conduitSyncData=function(t){conduitBuildData(t),conduitBuildUI(t)},conduitRegisterApps=function(){var a=t("[data-app]").not("._bound_app");if(a.length&&(a.each(function(){var a=t(this),i=a.data("app");conduitApp[i]={app:a,data:uix.config[i]?uix.config[i]:{}},a.addClass("_bound_app")}),uix.tabs))for(var i in uix.tabs)if(uix.tabs[i]["default"]){t('[data-tab="'+i+'"]').trigger("click");break}},conduitBuildUI=function(a){if(conduitApp[a]){var i=conduitApp[a].data;i._tab={};for(var e in conduitApp)e!==a&&(i._tab[e]=conduitApp[e].data);conduitApp[a].app.html(coduitTemplates[a](i))}t(window).trigger("modal.init")},conduitSetNode=function(a,i,e){for(var n=a.split("."),d='{ "'+n.join('": { "')+'" : '+JSON.stringify(e),o=0;o<n.length;o++)d+="}";var c=JSON.parse(d);t.extend(!0,conduitApp[i].data,c),conduitBuildUI(i)},conduitGenID=function(){var t=(new Date).getTime(),a="ndxxxxxxxx".replace(/[xy]/g,function(a){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==a?i:3&i|8).toString(16)});return a},conduitAddNode=function(a,i,e){var n=conduitGenID(),d=a.data?a.data("addNode").split("."):a.split("."),o=e?e:a.data("nodeDefault"),c=d.join(".")+"."+n,u=JSON.parse('{ "_id" : "'+n+'", "_node_point" : "'+c+'" }');o&&"object"==typeof o&&t.extend(!0,u,o);for(var p='{ "'+d.join('": { "')+'" : { "'+n+'" : '+JSON.stringify(u),r=0;r<=d.length;r++)p+="}";var s=JSON.parse(p);conduitBuildData(i),t.extend(!0,conduitApp[i].data,s),conduitBuildUI(i)},t(document).on("click",".cf-reports-card-actions .confirm a",function(a){a.preventDefault();var i=t(this).closest(".cf-reports-card-content");actions=i.find(".row-actions"),actions.slideToggle(300)}),t(document).on("keyup change",'[data-format="slug"]',function(a){var i=t(this);return i.data("master")&&i.prop("required")&&this.value.length<=0&&"change"===a.type?(this.value=t(i.data("master")).val().replace(/[^a-z0-9]/gi,"_").toLowerCase(),void(this.value.length&&i.trigger("change"))):void(this.value=this.value.replace(/[^a-z0-9]/gi,"_").toLowerCase())}),t(document).on("keyup change","[data-sync]",function(){var a=t(this),i=t(a.data("sync"));i.each(function(){var i=t(this);i.is("input")?i.val(a.val()).trigger("change"):i.text(a.val())})}),t(document).on("click","[data-add-node]",function(a){var i=t(this),e=i.closest("[data-app]").data("app");e&&"object"==typeof conduitApp[e]&&(a.preventDefault(),conduitAddNode(i,e))}),t(document).on("click","[data-remove-element]",function(a){var i=t(this),e=i.closest("[data-app]").data("app"),n=t(i.data("removeElement"));(!i.data("confirm")||confirm(i.data("confirm")))&&(n.remove(),conduitSyncData(e))}),t(document).on("click","[data-save-object]",function(a){a.preventDefault();var i,e=t(this),n=t(this).data("saveObject"),d=t(".page-title-action .spinner"),o=t(".uix-sub-nav");t(".uix-notice .notice-dismiss").trigger("click"),i=!0===n?conduitPrepObject():conduitPrepObject(n),e.addClass("saving"),d.slideDown(100);var c={action:uix.slug+"_save_config",uix_setup:t("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(i)};t.post(ajaxurl,c,function(a){d.slideUp(100),e.removeClass("saving");var i=t(coduitTemplates.__notice(a));i.hide().insertAfter(o).slideDown(200)})}),t(document).on("change","[data-live-sync]",function(a){var i=t(this).closest("[data-app]").data("app");conduitSyncData(i)}),t(document).on("click","button[data-live-sync]",function(a){var i=t(this).closest("[data-app]").data("app");conduitSyncData(i)}),t(document).on("click",".uix-notice .notice-dismiss",function(){var a=t(this).closest(".uix-notice");a.slideUp(200,function(){a.remove()})}),t(document).on("click","[data-tab]",function(a){a.preventDefault();var i=t(this),e=i.data("tab"),n=t(".active[data-tab]").data("tab");if(n){if(conduitBuildData(n),n===e)return;t('[data-app="'+n+'"]').empty().hide()}t("[data-tab]").removeClass("active"),t('[data-app="'+e+'"]').show(),i.addClass("active"),conduitBuildUI(e)}),t("script[data-template]").each(function(){var a=t(this),i=a.data("template");coduitTemplates[i]=Handlebars.compile(a.html(),{data:!0})}),t("script[data-handlebars-partial]").each(function(){var a=t(this);Handlebars.registerPartial(a.data("handlebarsPartial"),a.html())}),t(document).on("click","[data-modal-node]",function(a){var i,e=t(this),n=e.data("modal-node").split("."),d=e.data("app")?e.data("app"):n.shift(),o=e.data("type")?e.data("type"):"save";if("delete"!==o)try{i=e.closest(".caldera-modal-wrap").getObject()}catch(a){return}if("add"===o)conduitAddNode(n.join("."),d,i);else if("delete"===o){var c=n.shift();n.length&&(c+="["+n.join("][")+"]"),t('[name^="'+c+'"]').remove(),conduitBuildData(d),conduitBuildUI(d)}else conduitSetNode(n.join("."),d,i);t(window).trigger("close.modal")}),t(window).on("close.modal",function(a){var i=t(".active[data-tab]").data("tab");i&&conduitBuildUI(i)}),conduitRegisterApps()});